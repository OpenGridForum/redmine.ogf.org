<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">

This is a static archive of the previous Open Grid Forum Redmine content management system saved from host redmine.ogf.org file /issues/115 at Wed, 26 Oct 2022 23:20:32 GMT
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<title>bug #115: nead to clearify that all return values of &quot;methods&quot; are deep copies of values which must be freed by caller - DRMAAv2 C Binding - Open Grid Forum</title>
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta name="csrf-param" content="authenticity_token"/>
<meta name="csrf-token" content="AK0U3Lb6dpt4WWTJJ0cRxmhtMBdpfG/nfcCkNBP2hXA="/>
<link rel='shortcut icon' href='../favicon4460.ico?1425381960' />
<link href="../themes/ogf_redmine/stylesheets/application4460.css?1425381960" media="all" rel="stylesheet" type="text/css" />

<script src="../javascripts/prototype4460.js?1425381960" type="text/javascript"></script>
<script src="../javascripts/effects4460.js?1425381960" type="text/javascript"></script>
<script src="../javascripts/dragdrop4460.js?1425381960" type="text/javascript"></script>
<script src="../javascripts/controls4460.js?1425381960" type="text/javascript"></script>
<script src="../javascripts/application4460.js?1425381960" type="text/javascript"></script>
<script type="text/javascript">
//<![CDATA[
Event.observe(window, 'load', function(){ new WarnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>

<!--[if IE 6]>
    <style type="text/css">
      * html body{ width: expression( document.documentElement.clientWidth < 900 ? '900px' : '100%' ); }
      body {behavior: url(/stylesheets/csshover.htc?1425381960);}
    </style>
<![endif]-->
<link href="../plugin_assets/extended_fields/stylesheets/extended_fields4460.css?1425381960" media="screen" rel="stylesheet" type="text/css" /> <link href="../plugin_assets/wiking/stylesheets/wiking4460.css?1425381960" media="screen" rel="stylesheet" type="text/css" />
<!-- page specific tags -->

    <link href="https://redmine.ogf.org/issues/115.atom" rel="alternate" title="DRMAAv2 C Binding - bug #115: nead to clearify that all return values of &quot;methods&quot; are deep copies of values which must be freed by caller" type="application/atom+xml" />
    <link href="../stylesheets/scm4460.css?1425381960" media="screen" rel="stylesheet" type="text/css" />
    <script src="../javascripts/context_menu4460.js?1425381960" type="text/javascript"></script>
    <link href="../stylesheets/context_menu4460.css?1425381960" media="screen" rel="stylesheet" type="text/css" />
    
</head>
<body class="theme-Ogf redmine controller-issues action-show">
<div id="wrapper">
<div id="wrapper2">
<div id="top-menu">
    <div id="account">
        <ul><li><a href="https://redmine.ogf.org/login" class="login">Login</a></li>
<li><a href="../account/register.html" class="register">Register</a></li></ul>    </div>
    
    <ul><li><a href="../index.html" class="home">Home</a></li>
<li><a href="../projects.html" class="projects">Projects</a></li>
<li><a href="http://www.redmine.org/guide" class="help">Help</a></li></ul></div>

<div id="header">
    
    <div id="quick-search">
        <form action="https://redmine.ogf.org/search/index/drmaav2-c-binding" method="get">
        <input name="issues" type="hidden" value="1" />
        <label for='q'>
          <a href="../search/index/drmaav2-c-binding.html" accesskey="4">Search</a>:
        </label>
        <input accesskey="f" class="small" id="q" name="q" size="20" type="text" />
        </form>
        
    </div>
    

    <h1><a href="../projects/standards/issues.html?jump=issues" class="root">Standards</a> » <a href="../projects/applications-area/issues.html?jump=issues" class="ancestor">Applications Area</a> » <a href="../projects/drmaa-wg/issues.html?jump=issues" class="ancestor">DRMAA WG</a> » DRMAAv2 C Binding</h1>

    
    <div id="main-menu">
        <ul><li><a href="../projects/drmaav2-c-binding.html" class="overview">Overview</a></li>
<li><a href="../projects/drmaav2-c-binding/issues.html" class="issues selected">Issues</a></li>
<li><a href="../projects/drmaav2-c-binding/repository.html" class="repository">Repository</a></li></ul>
    </div>
    
</div>

<div class="" id="main">
    <div id="sidebar">
        
  <h3>Issues</h3>
<a href="https://redmine.ogf.org/projects/drmaav2-c-binding/issues?set_filter=1">View all issues</a><br />

<a href="../projects/drmaav2-c-binding/issues/report.html">Summary</a><br />


  
  











  

        
  
  


    </div>

    <div id="content">
        
        <div class="contextual">


<span class="issue-115-watcher"></span>




</div>


<h2>bug #115</h2>

<div class="issue status-16 priority-2 closed details">
        

<div class="subject">
<div><h3>nead to clearify that all return values of &quot;methods&quot; are deep copies of values which must be freed by caller</h3></div>
</div>
        <p class="author">
        Added by <a href="../users/78.html">Daniel Gruber</a> <a href="https://redmine.ogf.org/projects/drmaav2-c-binding/activity?from=2013-09-04" title="09/04/2013 07:42 AM">about 9 years</a> ago.
        
        Updated <a href="https://redmine.ogf.org/projects/drmaav2-c-binding/activity?from=2015-07-14" title="07/14/2015 04:15 PM">over 7 years</a> ago.
        
        </p>

<table class="attributes">
<tr>
    <th class="status">Status:</th><td class="status">closed</td>
    <th class="start-date">Start date:</th><td class="start-date">09/04/2013</td>
</tr>
<tr>
    <th class="priority">Priority:</th><td class="priority">Normal</td>
    <th class="due-date">Due date:</th><td class="due-date"></td>
</tr>
<tr>
    <th class="assigned-to">Assignee:</th><td class="assigned-to">-</td>
    <th class="progress">% Done:</th><td class="progress"><table class="progress" style="width: 80px;"><tr><td class="todo" style="width: 100%;"></td></tr></table><p class="pourcent">0%</p></td>
</tr>
<tr>
    <th class="category">Category:</th><td class="category">-</td>
    
</tr>
<tr>
    <th class="fixed-version">Target version:</th><td class="fixed-version">-</td>
    
</tr>


</table>

<hr />

  <div class="contextual">
  
  </div>

  <p><strong>Description</strong></p>
  <div class="wiki">
  <p>We have lots of C "methods" which expects an object and the return <br />value is a value of the object. Those return values are always copies.</p>


	<p>Example:</p>


	<p>drmaa2_jarray ja = drmaa2_jsession_get_job_array(js);</p>


	<p>ja is newly allocated and must be freed by drmaa2_jarray_free(&#38;ja).</p>


	<p>Or:</p>


	<p>drmaa2_string session_name = drmaa2_jarray_get_session_name(ja);</p>


	<p>session_name is newly allocated and must be freed by drmaa2_string_free(&#38;session_name).</p>


	<p>This must be emphasized in the C spec somewhere in order to prevent DRMAA2 implementations which <br />just return a pointer to an internal values of the super object.</p>
  </div>









</div>




<div id="history">
<h3>History</h3>

  <div id="change-236" class="journal has-notes has-details">
    <h4><div class="journal-link"><a href="115.html#note-1">#1</a></div>
    
    <a name="note-1"></a>
    Updated by <a href="../users/9.html">Peter Tröger</a> <a href="https://redmine.ogf.org/projects/drmaav2-c-binding/activity?from=2013-09-08" title="09/08/2013 08:59 AM">about 9 years</a> ago</h4>

    
    <ul class="details">
      
       <li><strong>Status</strong> changed from <i>submitted</i> to <i>accepted</i></li>
      
    </ul>
    
    <div class="wiki" id="journal-236-notes"><p>With DRMAAv1, we had the situation that people understood the binding specification as end-user manual, which we really should avoid.</p>


	<p>However, in this case, the spec may not be crystal clear even for the implementor. Section 2 has the following text:</p>


	<p>" All structures have a specific support function for freeing them (drmaa2 * free). Implementations SHOULD perform the freeing of struct members automatically if the struct itself is freed."</p>


	<p>This goes into the same direction, but is definitely not enough.</p>


	<p>We could either extend Section 2, or add another Section with "user manual recommendations".</p></div>
  </div>
  

  <div id="change-301" class="journal has-notes">
    <h4><div class="journal-link"><a href="115.html#note-2">#2</a></div>
    
    <a name="note-2"></a>
    Updated by <a href="../users/149.html">Stefan Klauck</a> <a href="https://redmine.ogf.org/projects/drmaav2-c-binding/activity?from=2013-09-19" title="09/19/2013 10:27 AM">about 9 years</a> ago</h4>

    
    <div class="wiki" id="journal-301-notes"><p>A general rule should be (current language binding and mock implementation):</p>


	<p>Users have to call drmaa2_*_free for each object they retrieve by using drmaa2 library functions.<br />Objects are all returned variables, whose type starts with drmaa2_ and is not implemented as enum (i.e. drmaa2_error, drmaa2_bool and drmaa2_state (the other enums are currently not returned directly by library functions) ).</p></div>
  </div>
  

  <div id="change-302" class="journal has-notes">
    <h4><div class="journal-link"><a href="115.html#note-3">#3</a></div>
    
    <a name="note-3"></a>
    Updated by <a href="../users/78.html">Daniel Gruber</a> <a href="https://redmine.ogf.org/projects/drmaav2-c-binding/activity?from=2013-09-24" title="09/24/2013 03:26 AM">about 9 years</a> ago</h4>

    
    <div class="wiki" id="journal-302-notes"><p>In DRMAA2 Grid Engine implementation we have following exceptions to the rule:
 * DRMAA2 dict accessors don't return deep copies (a dict is already a deep copy / main reason is because of performance).
 * The same for list accessors (traversing a list and always producing a copy and freeing is really not what we want).
 * Operation which are working on an array and returns one element of the given array. This is the wait for state function.</p></div>
  </div>
  

  <div id="change-514" class="journal has-notes">
    <h4><div class="journal-link"><a href="115.html#note-4">#4</a></div>
    
    <a name="note-4"></a>
    Updated by <a href="../users/1.html">Redmine Admin</a> <a href="https://redmine.ogf.org/projects/drmaav2-c-binding/activity?from=2014-09-09" title="09/09/2014 07:41 PM">about 8 years</a> ago</h4>

    
    <div class="wiki" id="journal-514-notes"><p>I agree with the exceptions listed by Daniel -- doing deep copy in those places would not be useful, IMHO.</p></div>
  </div>
  

  <div id="change-636" class="journal has-notes">
    <h4><div class="journal-link"><a href="115.html#note-5">#5</a></div>
    
    <a name="note-5"></a>
    Updated by <a href="../users/78.html">Daniel Gruber</a> <a href="https://redmine.ogf.org/projects/drmaav2-c-binding/activity?from=2014-11-05" title="11/05/2014 08:17 AM">almost 8 years</a> ago</h4>

    
    <div class="wiki" id="journal-636-notes"><p>As a result of OGF 42 in London I wrote a summary for the errata, when <br />copies and when pointer to existing objects needs to be returned:</p>


	<p>When do we have to free for DRMAA2 functions?</p>


	<p>DRMAA2 functions in C differ from the fact if return values are newly allocated or not. Unlike other APIs the DRMAA2 API functions can allocate the required memory for certain output values. The intention behind that is that it simplifies DRMAA2 applications. In case of errors such functions return either an error code or NULL if the newly allocated object should be returned.</p>


	<p>Following table shows which functions are returning newly allocated objects which needs to be freed by the API caller in order to prevent memory leaks. As a rule of thumb a developer can remember that calls to previously allocated collections does return just a pointer to the collection while functions which return objects which do not exist in the memory accessible by the user are returning a copy of the element.</p>


	<p>Following functions do return an object which needs to be freed:</p>


	<p>drmaa2_get_drms_name <br />drmaa2_get_drms_version<br />drmaa2_describe_attribute <br />drmaa2_dict_create<br />drmaa2_dict_list <br />drmaa2_get_instance_value<br />drmaa2_get_jsession_names<br />drmaa2_get_rsession_names<br />drmaa2_jarray_get_id<br />drmaa2_jarray_get_jobs<br />drmaa2_jarray_get_job_template &lt;—-name must be fixed other DRMAA2 issue<br />drmaa2_jarray_get_session_name<br />drmaa2_j_get_id<br />drmaa2_j_get_info<br />drmaa2_j_get_get_jt<br />drmaa2_j_get_session_name<br />drmaa2_jinfo_create<br />drmaa2_jinfo_impl_spec<br />drmaa2_jsession_get_contact<br />drmaa2_jsession_get_jarray<br />drmaa2_jsession_get_job_categories<br />drmaa2_jsession_get_jobs<br />drmaa2_jsession_get_session_name<br />drmaa2_jsession_run_bulk_jobs<br />drmaa2_jsession_run_job<br />drmaa2_jtemplate_create<br />drmaa2_jtemplate_impl_spec<br />drmaa2_lasterror_text<br />drmaa2_list_create<br />drmaa2_machineinfo_impl_spec<br />drmaa2_msession_get_all_jobs<br />drmaa2_msession_get_all_machines<br />drmaa2_msession_get_all_queues<br />drmaa2_msession_get_all_reservations<br />drmaa2_notification_impl_spec<br />drmaa2_open_jsession<br />drmaa2_open_msession<br />drmaa2_open_rsession<br />drmaa2_queueinfo_impl_spec<br />drmaa2_rinfo_impl_spec<br />drmaa2_rtemplate_impl_spec</p>


	<p>Following functions do return an object which is a pointer to an existing object:</p>


	<p>drmaa2_dict_get<br />drmaa2_list_get<br />drmaa2_jsession_wait_any_started<br />drmaa2_jsession_wait_any_terminated</p></div>
  </div>
  

  <div id="change-798" class="journal has-notes has-details">
    <h4><div class="journal-link"><a href="115.html#note-6">#6</a></div>
    
    <a name="note-6"></a>
    Updated by <a href="../users/9.html">Peter Tröger</a> <a href="https://redmine.ogf.org/projects/drmaav2-c-binding/activity?from=2015-07-14" title="07/14/2015 04:15 PM">over 7 years</a> ago</h4>

    
    <ul class="details">
      
       <li><strong>Status</strong> changed from <i>accepted</i> to <i>closed</i></li>
      
    </ul>
    
    <div class="wiki" id="journal-798-notes"><p>Fixed in July 2015 errata.</p></div>
  </div>
  




</div>



<div style="clear: both;"></div>
<div class="contextual">


<span class="issue-115-watcher"></span>




</div>


<div style="clear: both;"></div>


<p class="other-formats">(Other formats not available in this archive.</p>






<div id="context-menu" style="display: none;"></div>
<script type="text/javascript">
//<![CDATA[
new ContextMenu('/issues/context_menu')
//]]>
</script>

        
        <div style="clear:both;"></div>
    </div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>

<div id="footer">
  <div class="bgl"><div class="bgr">
    Powered by <a href="http://www.redmine.org/">Redmine</a> &copy; 2006-2012 Jean-Philippe Lang
  </div></div>
</div>
</div>
</div>

</body>

This is a static archive of the previous Open Grid Forum Redmine content management system saved from host redmine.ogf.org file /issues/115 at Wed, 26 Oct 2022 23:20:35 GMT
</html>
